version: 2.1

# Use the Node.js orb to simplify installation and caching
orbs:
  node: circleci/node@5.1.0

jobs:
  lint-and-type-check:
    docker:
      - image: cimg/node:22.12 # matches the Node version from our documentation
    steps:
      - checkout
      
      - node/install-packages:
          pkg-manager: npm

      # Check Formatting (Prettier)
      - run:
          name: Check Formatting
          command: npm run format:check
      
      # Linting (ESLint)
      - run:
          name: Lint
          command: npm run lint

      # Static Type Checking (TypeScript)
      - run:
          name: TypeScript Type Check
          command: npm run type-check

  unit-tests:
    docker:
      - image: cimg/node:22.12
    steps:
      - checkout
      - node/install-packages:
          pkg-manager: npm
      # run all unit tests
      - run:
          name: Run Jest Tests
          command: npm test

workflows:
  quality-gate:
    jobs:
      - lint-and-type-check
      - unit-tests:
          requires:
            - lint-and-type-check # Only run tests if types and formatting pass